request = require('request')
wolfram = require('wolfram-alpha').createClient("36P8G3-KWH3VUU3HP")

var generate = function (cb) {
    operands    = ['X', 'Y', 'Z', 'T']
    operators   = ['and', 'or', 'xor', 'implies', 'xnor']
    n_operators = 7
    var result = ""

    for (i=0; i<n_operators*2-1; i++){
        if (i % 2){
            r = Math.ceil(Math.random()*operators.length-1)
            result += operators[r]+" "
        } else {
            not = Math.round(Math.random()) ? "not " : ""
            r = Math.ceil(Math.random()*operands.length-1)
            result += not+operands[r]+" "
        }
    }
    for (i=0; i<operands.length; i++){
        if (!result.includes(operands[i])){
            console.log("BAD PLACE!")
            return generate(cb)
        }
    }
    console.log(result)
    wolfram.query("truth table "+result, function (err, data) {
        if (err) {
            cb(err);
            return;
        }
        row = data[1].subpods[0].text.split("\n")
        tt = []
        for (i=row.length-1; i>0; i--)
            tt.push(row[i].slice(-2).trim())
        expr = row[i].slice(15)

        cb({expression: expr, tt: tt});
    });
}

module.exports.generate = generate